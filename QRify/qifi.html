<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Theme QR Code Generator</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> <!-- Bootstrap CSS -->

    <style>
        /* Dark theme styles */

        body {
            background-color: #282c34;
            color: #abb2bf;
        }

        .container {
            background-color: #21252b;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
        }

        .form-control,
        .btn {
            background-color: #363c4a;
            border-color: #363c4a;
            color: #abb2bf;
        }

        .btn:hover {
            background-color: #5c6370;
            border-color: #5c6370;
        }

        .checkbox label {
            color: #abb2bf;
        }

        #qrcode {
            background-color: #363c4a;
            border: 2px solid #282c34;
        }

        #history-drop {
            background-color: #21252b;
        }

        /* Dark theme styles end */
    </style>
</head>
<body>
    <div class="container">
        <form id="form">
            <div class="form-group">
                <label for="ssid">SSID:</label>
                <input type="text" class="form-control" id="ssid" required>
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox" id="hidden"> Hidden
                </label>
            </div>
            <div class="form-group">
                <label for="enc">Encryption:</label>
                <select class="form-control" id="enc">
                    <option value="nopass">No Password</option>
                    <!-- Add other encryption options if needed -->
                </select>
            </div>
            <div id="key-p" class="form-group">
                <label for="key">Key:</label>
                <input type="password" class="form-control" id="key">
            </div>
            <button type="submit" class="btn btn-primary">Generate QR Code</button>
        </form>
        <div id="qrcode"></div>
        <p id="showssid"></p>
        <button id="save" class="btn btn-success" style="display: none;">Save Configuration</button>
        <a id="export" style="display: none;" download="qrcode.png">Export QR Code</a>
        <div id="history-drop">
            <ul class="dropdown-menu"></ul>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script> <!-- jQuery -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> <!-- Bootstrap JS -->
    <script src="jquery.qrcode.min.js"></script> <!-- QR Code Generator Plugin -->

    <script>
        // JavaScript code
        function escape_string(string) {
            var to_escape = ['\\', ';', ',', ':', '"'];
            var hex_only = /^[0-9a-f]+$/i;
            var output = "";
            for (var i = 0; i < string.length; i++) {
                if ($.inArray(string[i], to_escape) != -1) {
                    output += '\\' + string[i];
                } else {
                    output += string[i];
                }
            }
            return output;
        }

        function generate() {
            var ssid = $('#ssid').val();
            var hidden = $('#hidden').is(':checked');
            var enc = $('#enc').val();
            if (enc != 'nopass') {
                var key = $('#key').val();
                $('#showkey').text(enc + ' Passphrase: ' + key);
            } else {
                var key = '';
                $('#showkey').text('');
            }
            var qrstring = 'WIFI:S:' + escape_string(ssid) + ';T:' + enc + ';P:' + escape_string(key) + ';';
            if (hidden) {
                qrstring += 'H:true';
            }
            qrstring += ';';
            $('#qrcode').empty();
            $('#qrcode').qrcode(qrstring);
            $('#showssid').text('SSID: ' + ssid);
            $('#save').show();
            $('#print').css('display', 'inline-block');

            var canvas = $('#qrcode canvas');
            if (canvas.length == 1) {
                var data = canvas[0].toDataURL('image/png');
                var e = $('#export');
                e.attr('href', data);
                e.attr('download', ssid + '-qrcode.png');
                e.css('display', 'inline-block');
            }
        }

        function save() {
            var ssid = $('#ssid').val();
            if (!ssid) return;
            var hidden = $('#hidden').is(':checked');
            var enc = $('#enc').val();
            var key = $('#key').val();
            var storage = $.localStorage('qificodes');
            if (!storage) storage = {};
            storage[ssid] = { 'hidden': hidden, 'enc': enc, 'key': key };
            $.localStorage('qificodes', storage);
            loadhistory();
        }

        function load(ssid) {
            var storage = $.localStorage('qificodes');
            if (ssid in storage) {
                $('#ssid').val(ssid);
                $('#enc').val(storage[ssid]['enc']);
                $('#key').val(storage[ssid]['key']);
                $('#hidden').prop('checked', storage[ssid]['hidden']);
                generate();
            }
        }

        function loadhistory() {
            var storage = $.localStorage('qificodes');
            if (storage) {
                var history = $('#history-drop ul.dropdown-menu');
                var ssids = Object.keys(storage);
                history.empty();
                for (var i = 0; i < ssids.length; i++) {
                    history.append('<li role="presentation"><a role="menuitem" tabindex="-1" href="#" class="history-item">' + ssids[i] + '</a></li>');
                }
                history.append('<li role="presentation" class="divider"></li>');
                history.append('<li role="presentation"><a role="menuitem" tabindex="-1" href="#" class="history-clear">clear history</a></li>');

                history.on('click', 'a.history-item', function (e) {
                    e.preventDefault();
                    load($(this).text());
                });
                history.on('click', 'a.history-clear', function (e) {
                    e.preventDefault();
                    clearhistory();
                });
                $('#history-drop').show();
            }
        }

        function clearhistory() {
            $.localStorage('qificodes', null);
            $('#history-drop').hide();
        }

        $(document).ready(function () {
            $('#form').submit(function () {
                generate();
                return false;
            });
            $('#save').click(function () {
                save();
            });
            $('#display-key').click(function () {
                var $key = $("#key");
                if ($key.attr('type') === 'password') {
                    $key.attr('type', 'text');
                    $("#display-key-icon").attr("class", "glyphicon glyphicon-eye-close");
                } else {
                    $key.attr('type', 'password');
                    $("#display-key-icon").attr("class", "glyphicon glyphicon-eye-open");
                }
            });
            $('#enc').change(function () {
                if ($(this).val() != 'nopass') {
                    $('#key-p').show();
                    $('#key').attr('required', 'required');
                } else {
                    $('#key-p').hide();
                    $('#key').removeAttr('required');
                }
            });
            $('#form').tooltip({
                selector: "[data-toggle=tooltip]"
            });
            loadhistory();
        });

        // Service Worker installation
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/sw.js', { scope: './' }).then(function (registration) {
                    console.log('[Service Worker] Successfully installed');
                }).catch(function (error) {
                    console.log('[Service Worker] Installation failed:', error);
                });
            });
        }
    </script>
</body>
</html>
